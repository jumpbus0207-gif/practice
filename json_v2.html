<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Vue.js sample-json_v2</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/vue.js"></script>
    <style>
        .v-move {
            transition: 1s;
        }
    </style>
</head>
<body>
    <h2>Jsonを読み込んでコンポーネントで並べる</h2>
    <div id="jsonComp">
        <transition-group>
            <div v-for="item in dataArray" :key="item.title">
                <my-product :object="item"></my-product>
            </div>
        </transition-group>
        <button @click="sortData">ソート</button>
        <button @click="shuffleData">シャッフル</button>
        <p><input type="file" @change="loadData"></p>
    </div>
<script>
    var MyComponent = {
        props: ["object"],
        template:`
        <div style="width:300px;backgroundColor:#ffddaa;">
            <p style="backgroundColor:#ffa95e;">{{object.title}}</p>
            <p>解説：{{object.body}}</p>
        </div>`
    }

    new Vue({
        el:'#jsonComp',
        data: {
            dataArray: [
                {title:'AAA',body:'aaa'},
                {title:'BBB',body:'bbb'},
                {title:'CCC',body:'ccc'}
            ]
        },
        components: {
            'my-product': MyComponent
        },
        methods: {
            sortData: function() {
                this.dataArray.sort(function(a,b) {
                    return (a.title < b.title ? -1 : 1);
                    return 0;
                });
            },
            shuffleData: function() {
                var buffer = [];
                var len = this.dataArray.length;
                for (var i=len; len>0;len--) {
                    var r = Math.floor(Math.random()*len);
                    buffer.push(this.dataArray[r]);
                    this.dataArray.splice(r, 1);
                }
                this.dataArray = buffer;
            },
            loadData: function(e) {
                file = e.target.files[0]
                if (file) {
                    var reader = new FileReader()
                    var vm = this;
                    reader.onload = function(e) {
                        vm.dataArray = JSON.parse(e.target.result);
                    } 
                    reader.readAsText(file)
                }
            }
        }
    });
</script>
</body>
</html>